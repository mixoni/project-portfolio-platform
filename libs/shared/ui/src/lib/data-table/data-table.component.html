<div class="pp-table-wrapper" [class.pp-loading]="loading">
  <div class="pp-table-toolbar" *ngIf="showToolbar">
    <div class="pp-table-toolbar-left">
      <ng-content select="[ppTableFilters]"></ng-content>
    </div>

    <div class="pp-table-toolbar-right">
      <input *ngIf="enableSearch" type="search" [placeholder]="searchPlaceholder" [(ngModel)]="searchTerm"
        (ngModelChange)="onSearchInput($event)" />

      <button *ngIf="showCreateButton" type="button" class="pp-btn pp-btn-primary" (click)="onCreateClick()">
        {{ createLabel }}
      </button>
    </div>
  </div>

  <ng-container *ngIf="loading; else tableContent">
    <div class="pp-skeleton-row" *ngFor="let _ of [0, 1, 2, 3]">
      <div class="pp-skeleton-cell" *ngFor="let __ of columns"></div>
    </div>
  </ng-container>

  <ng-template #tableContent>
    <table class="pp-table" *ngIf="columns?.length; else noColumns">
      <thead>
        <tr>
          <th *ngFor="let col of columns">
            {{ col.header }}
          </th>
          <th *ngIf="showRowMenu" class="pp-actions-header"></th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let row of rows; trackBy: trackByIndex; let i = index" (click)="onRowClicked(row)"
          [class.pp-row-clickable]="clickableRows">
          <td *ngFor="let col of columns">
            {{
            getCell(row, col)
            | displayValue:
            (col.emptyPlaceholder || '—'):
            (col.format || 'text'):
            undefined:
            (col.currency || 'EUR')
            }}
          </td>

          <td *ngIf="showRowMenu" class="pp-row-actions" (click)="$event.stopPropagation()">
            <button type="button" class="pp-icon-button" (click)="toggleMenu(i)">
              ⋮
            </button>

            <div class="pp-row-menu" *ngIf="menuOpenIndex === i">
              <button type="button" (click)="onEdit(row)">Edit</button>
              <button type="button" class="danger" (click)="onDelete(row)">
                Delete
              </button>
            </div>
          </td>
        </tr>

        <tr *ngIf="rows.length === 0">
          <td [attr.colspan]="columns.length + (showRowMenu ? 1 : 0)" class="pp-empty">
            {{ emptyMessage }}
          </td>
        </tr>
      </tbody>
    </table>
  </ng-template>

  <ng-template #noColumns>
    <div class="pp-empty">No columns configured</div>
  </ng-template>
</div>